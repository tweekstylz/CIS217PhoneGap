<!DOCTYPE html>
<html>
<head>
    <title>Italy Pizza &copy;</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="themes/italypizza.min.css" />
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile.structure-1.3.1.min.css" />
    <script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
    <script type="text/javascript" charset="utf-8" src="js/cordova.js"></script>
    <script type="text/javascript" charset="utf-8">

        // Wait for Cordova to load
        //
        document.addEventListener("deviceready", onDeviceReady, false);

        // Cordova is ready
        //
        function onDeviceReady() {
            // Empty
        }

        // Show a custom alert
        //
        function showAlert() {
            navigator.notification.alert(
                    'You added a pizza to your cart!',  // message
                    'Pizza',            // title
                    'Continue'                  // buttonName
            );
        }

        // Beep three times
        //
        function playBeep() {
            navigator.notification.beep(3);
        }

        // Vibrate for 2 seconds
        //
        function vibrate() {
            navigator.notification.vibrate(2000);
        }

    </script>

    <!--<a href="#" onclick="showAlert(); return false;">Show Alert</a>
    <a href="#" onclick="playBeep(); return false;">Play Beep</a>
    <a href="#" onclick="vibrate(); return false;">Vibrate</a>-->
    <style>
        table {
            background-color: #383838;
        }
        th {
            background-color: #64a2cf;
        }
        td {
            padding: 15px;
            background-color: rgb(255, 255, 255);
        }
    </style>
</head>

<body data-dave="red">

<!-- ******************************************************** CALL US PAGE ************************************************* -->

<div data-role="page" id="callus">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#callus" class="ui-btn-active ui-state-persist">CALL US</a></li>
                <li><a href="#menu">Menu</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#location">Location</a></li>
                <li><a href="#about_us">About Us</a></li>
            </ul>
        </div>
    </div>


    <h2>Welcome to Italy Pizza &trade;</h2><br/><br/>

    Call in your order and we'll have it ready hen you get here.

    <a href="tel:555-555-5555" data-role="button" onclick="vibrate(); return false;">Call us</a>
<!--
    <a href="sms://555-555-5555?body=Here%20is%20my%20order:" data-role="button">Text us your order now</a>
    <a href="mailto:josh_23@homtail.com?subject=My%20Pizza%20Order&body=My%20order" data-role="button">Email your order</a>
-->
    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** MENU PAGE ************************************************* -->

<div data-role="page" id="menu">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#callus">CALL US</a></li>
                <li><a href="#menu" class="ui-btn-active ui-state-persist">Menu</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#location">Location</a></li>
                <li><a href="#about_us">About Us</a></li>
            </ul>
        </div>
    </div>


    <div data-role="content">
        <img src="img/pepperoni.jpg" />
        <div data-product="1" class="product">
            <span data-name='pepperoni'>Pepperoni Pizza&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span data-price='19.95'>$ 19.95&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span class='description'>Soooo Good!&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>
        <img src="img/pep_olive.jpg" />
        <div data-product="2" class="product">
            <span data-name='Pep w/Olives'>Pepperoni With Olives&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span data-price='21.95'>$ 21.95&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span class='description'>Even better with Olives!&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>
        <img src="img/hampine.jpg" />
        <div data-product="3" class="product">
            <span data-name='Ham & Pineapple'>Ham & Pineapple&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span data-price='22.95'>$ 22.95&nbsp;&nbsp;&nbsp;&nbsp;</span>
            <span class='description'>Hawaiian Yumminess!&nbsp;&nbsp;&nbsp;&nbsp;</span>
        </div>

        <div class='cartDiv'>

        </div>
        <div>
            <button id="buy">Buy Now</button>
        </div>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** ORDER PAGE ************************************************* -->

<div data-role="page" id="order">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#callus">CALL US</a></li>
                <li><a href="#menu">Menu</a></li>
                <li><a href="#order" class="ui-btn-active ui-state-persist">Order Online</a></li>
                <li><a href="#location">Location</a></li>
                <li><a href="#about_us">About Us</a></li>
            </ul>
        </div>
    </div>

    <div data-role="content">
        <div id="orderDetails">
            <h1>Here is your order so far....</h1>
            <div class='cartDiv'>

            </div>
        </div>
        <div>
            <button id="buy2">Buy Now</button><br/>
        </div>
        <div>
            <button id="saveOrder">Save Order</button><br/>
        </div>
        <div>
            <button id="loadOrder">Load Order</button>
        </div>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** MAP PAGE ************************************************* -->

<div data-role="page" id="location">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#callus">CALL US</a></li>
                <li><a href="#menu">Menu</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#location" class="ui-btn-active ui-state-persist">Location</a></li>
                <li><a href="#about_us">About Us</a></li>
            </ul>
        </div>
    </div>


    <div data-role="content">

            <script>
                navigator.geolocation.getCurrentPosition(function(pos){
                    var lat = pos.coords.latitude;
                    var lng = pos.coords.longitude;
                    console.log( lat + " : " + lng);
                    $("#lat").text( lat );
                    $("#lng").text( lng );
                    // var url = '<a href="http://maps.google.com/maps?q=' + lat + ',' + lng + '">Your Location</a>';
                    // saddr=???&daddr=????
                    //https://maps.google.com/maps?daddr=Pizza+Hut,+3304+N.+Nevada,+Spokane,+WA+99207+(Pizza+Hut)&hl=en&sll=47.689255,-117.390461&sspn=0.046048,0.048065&geocode=CXQaZiTkposfFQyr1wIdZLEA-Q&t=h&mra=ls&z=14

                    var url = '<a href="http://maps.google.com/maps?daddr=Pizza+Hut,+3304+N.+Nevada,+Spokane,+WA+99207&saddr=' + lat + ',' + lng + '">Your Location</a>';
                        $("#url").html( url );

                    var map = '<iframe width="360" height="360" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="https://maps.google.com/maps?daddr=Pizza+Hut,+3304+N.+Nevada,+Spokane,+WA+99207&amp;saddr=' + lat + ',+' + lng + '&amp;ie=UTF8&amp;t=h&amp;ll=47.67371,-117.410545&amp;spn=0.020806,0.030813&amp;z=14&amp;output=embed"></iframe><br /><small><a href="https://maps.google.com/maps?daddr=Pizza+Hut,+3304+N.+Nevada,+Spokane,+WA+99207&amp;saddr=47.65878000000001,-117.426047&amp;ie=UTF8&amp;t=h&amp;ll=47.67371,-117.410545&amp;spn=0.020806,0.030813&amp;z=14&amp;source=embed" style="color:#0000FF;text-align:left">View Larger Map</a></small>';
                        $("#directionMap").html(map);
                })
            </script>
        <p>
        Italy Pizza &trade;<br/>
        3304 N. Nevada <br/>
        Spokane, WA 99207 <br/>
        </p>
        <div id="directionMap">

        </div>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** MENU PAGE ************************************************* -->

<div data-role="page" id="about_us">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#callus">CALL US</a></li>
                <li><a href="#menu">Menu</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#location">Location</a></li>
                <li><a href="#about_us" class="ui-btn-active ui-state-persist">About Us</a></li>
            </ul>
        </div>
    </div>


    <div data-role="content">
        <p>
            Italy Pizza &trade;<br/>
            3304 N. Nevada <br/>
            Spokane, WA 99207 <br/>

            tel:  (555) 555-5555<br/>

            email:  italypizza@pizzaplace.com<br/>
            Call of Visit us today!<br/>
        </p>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** CONFIRM PAGE *************************************************-->

<div data-role="page" id="confirm">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#callus">CALL US</a></li>
                <li><a href="#menu">Menu</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#location">Location</a></li>
                <li><a href="#about_us">About Us</a></li>
                <li><a href="#confirm" class="ui-btn-active ui-state-persist">CONFIRM</a></li>
            </ul>
        </div>
    </div>


    <div data-role="content">
        <div class='cartDiv'>

        </div>

        <div data-order="1" class='confirmCart'>

        </div>

    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>



<script>
    var cart = [];

    function displayCart(){
        var cartDiv = $('.cartDiv');
        cartDiv.html("");
        var grandTotal = 0;
        for(var item in cart){
            var qty = cart[item].qty;
            var price = cart[item].price;
            var subtotal = qty * price;
            grandTotal += subtotal;

            cartDiv.append( '<p>I want <strong>' + qty + '</strong> ' + cart[item].name +
                            ' pizza(s) @ $' + price.toFixed(2) + ' == $' +
                            subtotal.toFixed(2) + '</p>');
        }
        cartDiv.append( '<p>Grand Total: $' + grandTotal.toFixed(2) + '</p>')
    }

    $(document).ready(function(){
        // Add a buy button to each of my products

        $('div[data-product]').each( function(){
            $(this).append('<button onclick="showAlert(); return false;" class="btnCart">Add 1 To Cart</button>');
        })

        $('.btnCart').on("click", function(event){
            var pid = $(this).parent().parent().data("product");
            console.log( pid );
            if( cart[pid] ){
                cart[pid].qty += 1;
            } else {
                cart[pid] = new Object();
                cart[pid].qty = 1;
                cart[pid].name = $(this).parent().siblings("span").data("name");
                cart[pid].price = $(this).parent().siblings("span").next().data("price");
            }
            displayCart();
        })

        $('#buy').on("click", function(event){
            displayCart();
            window.location = "#order";

            var buyUrl = "";
            for( var item in cart ){
                buyUrl += "&pid[]=" + item + "&qty[]=" + cart[item].qty;
            }
            $.getJSON( 'buy.php?' + buyUrl, function(data){
                $('<ul>', {
                    'class': 'myu-new-list',
                    html: data
                }).appendTo( '.cartDiv');
                //$(".cartDiv").append(data);
            })
            console.log( "http://cis230.cis1scc.com/buy.php?" + buyUrl);
            $("#buy").parent().hide();
        })

        $('#buy2').on("click", function(event){
            displayCart();
            window.location = "#confirm";

            var buyUrl = "";
            for( var item in cart ){
                buyUrl += "&pid[]=" + item + "&qty[]=" + cart[item].qty;
            }
            $.getJSON( 'buy.php?' + buyUrl, function(data){
                $('<ul>', {
                    'class': 'myu-new-list',
                    html: data
                }).appendTo( '.cartDiv');
                //$(".cartDiv").append(data);
            })
            console.log( "http://cis217-4-jnovak.azurewebsites.net/buy.php?" + buyUrl);
            //$("#buy").parent().hide();
        })

        $('#saveOrder').on("click", function(event){
            alert("Your Order Has Been Saved!");
            var cartStr = "[";
            for( var item in cart ){
                cartStr += JSON.stringify( cart[item] ) + ",";
            }
            cartStr = cartStr.slice(0,-1);
            cartStr += "]";
            console.log( cartStr );
            localStorage['cart'] = cartStr;
        })

        $('#loadOrder').on("click", function(){
            alert("We've loaded your last saved order!");
            cart = [];
            var obj = JSON.parse( localStorage['cart'] );
            for( item in obj ){
                pid = obj[item].pid;
                cart[ pid ] = obj[item];
            }
            displayCart();
        })

        $('div[data-order]').each( function(){
            //alert("I'm here!");
            displayCart();

            $(this).append('<a data-role="button" href="mailto:josh_23@homtail.com?subject=My%20Pizza%20Order&body=' + order + '">Email us your order now</a><br/>');
            $(this).append('<a data-role="button" href="sms://555-555-5555?body=' + order + '">Text us your order now</a><br/>');
        })
    })
</script>
</body>
</html>
