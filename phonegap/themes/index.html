
<!DOCTYPE html>
<html>
<head>
    <title>First Mobile Example</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="themes/italypizza.min.css" />
	<link rel="stylesheet" href="http://code.jquery.com/mobile/1.3.1/jquery.mobile.structure-1.3.1.min.css" />
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://code.jquery.com/mobile/1.3.1/jquery.mobile-1.3.1.min.js"></script>
    <style>
        table {
            background-color: #383838;
        }
        th {
            background-color: #64a2cf;

        }
        td {
            padding: 15px;
            background-color: rgb(255, 255, 255);
        }
    </style>
</head>

<body data-dave="red">

<!-- ******************************************************** HOME PAGE ************************************************* -->

<div data-role="page" id="home">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#home" class="ui-btn-active ui-state-persist">Home</a></li>
                <li><a href="#friend">Friends</a></li>
                <li><a href="#album">Albums</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#map">Map</a></li>
            </ul>
        </div>
    </div>


    Welcome to our first mobile web site.<br/>
    <a href="tel:555-555-5555" data-role="button">Call us</a>
    <a href="sms://555-555-5555?body=Here%20is%20my%20order:" data-role="button">Text us your order now</a>
    <a href="mailto:josh_23@homtail.com?subject=My%20Pizza%20Order&body=My%20order" data-role="button">Email your order</a>
    </p>
    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** FRIEND PAGE ************************************************* -->

<div data-role="page" id="friend">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#home">Info</a></li>
                <li><a href="#friend" class="ui-btn-active ui-state-persist">Friends</a></li>
                <li><a href="#album">Albums</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#map">Map</a></li>
            </ul>
        </div>
    </div>


    <div data-role="content">
        <ul data-role="listview" data-inset="true" data-native-menu="false" data-split-theme="d" data-split-icon="delete" data-filter="true" data-filter-placeholder="Search Friend(s)...">
            <li><a href="#josh"><img class="ui-li-icon" src="http://placeimg.com/16/16/people"/> Josh</a></li>
            <li><a href="#redbeard"><img class="ui-li-icon" src="http://placeimg.com/30/30/people"/> Redbeard</a></li>
            <li><a href="#ryan"><img class="ui-li-icon" src="http://placeimg.com/30/30/people"/> Ryan</a></li>
            <li data-role="list-divider">Best-Homies</li>
            <li><a href="#finn"><img class="ui-li-icon" src="http://placeimg.com/30/30/people"/> Finn the human</a></li>
            <li><a href="#jake"><img class="ui-li-icon" src="http://placeimg.com/30/30/people"/> Jake the dog</a></li>
        </ul>
        <p>
            HAMBONE!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
        </p>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** ALBUM PAGE ************************************************* -->

<div data-role="page" id="album">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#home">Info</a></li>
                <li><a href="#friend">Friends</a></li>
                <li><a href="#album" class="ui-btn-active ui-state-persist">Albums</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#map">Map</a></li>
            </ul>
        </div>
    </div>

    <div data-role="content">
        <p>
            This is my 3rd page.
        </p>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** JOSH PAGE ************************************************* -->

<div data-role="page" id="josh">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#home">Info</a></li>
                <li><a href="#friend">Friends</a></li>
                <li><a href="#album" class="ui-btn-active ui-state-persist">Albums</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#map">Map</a></li>
            </ul>
        </div>
    </div>

    <div data-role="content">
        <p>
            This is Josh's Page.
        </p>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** ORDER PAGE ************************************************* -->

<div data-role="page" id="order">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#home">Info</a></li>
                <li><a href="#friend">Friends</a></li>
                <li><a href="#album">Albums</a></li>
                <li><a href="#order" class="ui-btn-active ui-state-persist">Order Online</a></li>
                <li><a href="#map">Map</a></li>
            </ul>
        </div>
    </div>

    <!--<div data-role="content">
        <p>
            <script>
                $(document).ready(function(){
                    var orderform = '<iframe src="https://docs.google.com/forms/d/1yqguD4ctn3M_WtxOIGoAMiJ10gvRpvuJ3SKk2JneRkU/viewform?embedded=true" width="760" height="1000" frameborder="0" marginheight="0" marginwidth="0">Loading...</iframe>';
                    $("#orderForm").html(orderform);
                })
            </script>
            Order Online Here!
            <div id="orderForm">

            </div>
        </p>
    </div>-->

    <div data-role="content">
        <div data-product="1" class="product">
            <span data-name='pizza'>Pizza</span>
            <span data-price='19.95'>19.95</span>
            <span class='description'>Round Awesomeness</span>
        </div>

        <div data-product="2" class="product">
            <span data-name='breadstick'>Breadstick</span>
            <span data-price='9.95'>9.95</span>
            <span class='description'>Sticks of Awesomeness</span>
        </div>

        <div data-product="3120" class="product">
            <span data-name='wings'>Wings</span>
            <span data-price='19.95'>19.95</span>
            <span class='description'>Wings of Chicken that you'll eat</span>
        </div>

        <div id='cartDiv'>

        </div>
        <div>
            <p><button id="buy">Buy Now</button></p>
        </div>
		<div>
            <button id="saveOrder">Save Order</button>
        </div>
        <div>
            <button id="loadOrder">Load Order</button>
        </div>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>

<!-- ******************************************************** MAP PAGE ************************************************* -->

<div data-role="page" id="map">

    <div data-role="header" data-id="navbar" data-position="fixed">
        <div data-role="navbar">
            <ul>
                <li><a href="#home">Info</a></li>
                <li><a href="#friend">Friends</a></li>
                <li><a href="#album">Albums</a></li>
                <li><a href="#order">Order Online</a></li>
                <li><a href="#map" class="ui-btn-active ui-state-persist">Map</a></li>
            </ul>
        </div>
    </div>

    <div data-role="content">
        <p>
            <script>
                navigator.geolocation.getCurrentPosition(function(pos){
                    var lat = pos.coords.latitude;
                    var lng = pos.coords.longitude;
                    console.log( lat + " : " + lng);
                    $("#lat").text( lat );
                    $("#lng").text( lng );
                    // var url = '<a href="http://maps.google.com/maps?q=' + lat + ',' + lng + '">Your Location</a>';
                    // saddr=???&daddr=????
                    https://maps.google.com/maps?daddr=Pizza+Hut,+3304+N.+Nevada,+Spokane,+WA+99207+(Pizza+Hut)&hl=en&sll=47.689255,-117.390461&sspn=0.046048,0.048065&geocode=CXQaZiTkposfFQyr1wIdZLEA-Q&t=h&mra=ls&z=10

                    var url = '<a href="http://maps.google.com/maps?daddr=12614+E.+31st,+Spokane,+WA+99216&saddr=' + lat + ',' + lng + '">Your Location</a>';
                        $("#url").html( url );

                    var map = '<iframe width="360" height="360" frameborder="0" scrolling="no" marginheight="0" marginwidth="0" src="http://maps.google.com/maps?daddr=12614+E.+31st,+Spokane,+WA+99216&saddr=' + lat + ',' + lng + '&amp;ie=UTF8&amp;t=h&amp;&amp;ll=47.67371,-117.410545&amp;spn=0.020806,0.030813&amp;z=10&amp;output=embed"></iframe><br /><small><a href="http://maps.google.com/maps?daddr=12614+E.+31st,+Spokane,+WA+99216&saddr==47.65878000000001,-117.426047&amp;ie=UTF8&amp;t=h&amp;&amp;ll=47.67371,-117.410545&amp;spn=0.020806,0.030813&amp;z=10&amp;source=embed" style="color:#0000FF;text-align:left">View Larger Map</a></small>';
                        $("#directionMap").html(map);
                })
            </script>
            Latitude: <span id="lat"></span><br/>
            Longitude: <span id="lng"></span>
            Url: <span id="url"></span>

            Display Actual Map Here!
        <div id="directionMap">

        </div>
        </p>
    </div>

    <div data-role="footer" data-position="fixed">
        <i>Copyright Italy Pizza &copy; 2013</i>
    </div>

</div>
<script>
    var cart = [];

    function displayCart(){
        var cartDiv = $('#cartDiv');
        cartDiv.html("");
        var grandTotal = 0;
        for(var item in cart){
            var qty = cart[item].qty;
            var price = cart[item].price;
            var subtotal = qty * price;
            grandTotal += subtotal;

            cartDiv.append('<table border="1">\r\t' +
                             '<tr>\r\t\t' +
                                '<th>Quantity</th>\r\t\t' +
                                '<th>Name</th>\r\t\t' +
                                '<th>Price</th>\r\t\t' +
                                '<th>Total</th>\r\t' +
                             '</tr>\r\t'+
                             '<tr>\r\t' +
                                '<td>' + qty + '</td>\r\t\t' +
                                '<td>' + cart[item].name + '</td>\r\t\t' +
                                '<td>$' + price.toFixed(2) + '</td>\r\t\t' +
                                '<td>$' +  subtotal.toFixed(2) + '</td>\r\t' +
                             '</tr>\r' +
                           '</table>');
        }
        cartDiv.append( '<p>Grand Total: $' + grandTotal.toFixed(2) + '</p>')
    }

    $(document).ready(function(){
        // Add a buy button to each of my products

        $('div[data-product]').each( function(){
            $(this).append('<button class="btnCart">Add To Cart</button>');
        })

        $('.btnCart').on("click", function(event){
            var pid = $(this).parent().parent().data("product");
            console.log( pid );
            if( cart[pid] ){
                cart[pid].qty += 1;
            } else {
                cart[pid] = new Object();
                cart[pid].qty = 1;
                cart[pid].name = $(this).parent().siblings("span").data("name");
                cart[pid].price = $(this).parent().siblings("span").next().data("price");
            }
            displayCart();
        })

        $('#buy').on("click", function(event){
            var buyUrl = "";
            for( var item in cart ){
                buyUrl += "&pid[]=" + item + "&qty[]=" + cart[item].qty;
            }
            $.getJSON( 'http://cis217-4-jnovak.azurewebsites.net/buy.php?' + buyUrl, function(data){
                $('<ul/>', {
                    'class': 'myu-new-list',
                    html: data
                }).appendTo( '#cartDiv');
                $("#cartDiv").append(data);
            })
            console.log( "http://cis217-4-jnovak.azurewebsites.net/buy.php?" + buyUrl);
            $("#buy").parent().hide();
        })
		
		$('#saveOrder').on("click", function(event){
            var cartStr = "[";
            for( var item in cart ){
                cartStr += JSON.stringify( cart[item] ) + ",";
            }
            cartStr = cartStr.slice(0,-1);
            cartStr += "]";
            console.log( cartStr );
            localStorage['cart'] = cartStr;
        })

        $('#loadOrder').on("click", function(){
            cart = [];
            var obj = JSON.parse( localStorage['cart'] );
            for( item in obj ){
                pid = obj[item].pid;
                cart[ pid ] = obj[item];
            }
            displayCart();
        })
    })
</script>
</body>
</html>
